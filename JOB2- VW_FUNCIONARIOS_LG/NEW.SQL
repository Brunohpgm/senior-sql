
WITH PESSOA AS
 (SELECT P.ID_PESSOA, P.CPF, P.NOME, PA.FUNCIONARIO
    FROM TB_PESSOA P, TB_PESSOA_ATRIBUTO PA
   WHERE P.ID_PESSOA = PA.ID_PESSOA),

FUNCIONARIOS AS
 (SELECT TO_NUMBER(C.CPF) AS CPF_PESSOA,
       'S' AS EH_FUNCIONARIO,
       'PAGUE MENOS FILIAL ' || LPAD(TO_CHAR(C.FILIAL - 1000), 2, 0) AS DESCRICAO_ESTABELECIMENTO
  FROM SENIOR.TB_COLABORADOR@RH C
 WHERE C.SITUACAO_AFASTAMENTO <> 7
   AND C.TIPO <> 2)

SELECT A.ID_PESSOA,
       A.CPF,
       A.NOME,
       A.FUNCIONARIO,
       NVL(B.EH_FUNCIONARIO, 'N') AS SIT_FUNCIONARIO
  FROM PESSOA A
  LEFT JOIN FUNCIONARIOS B
    ON (A.CPF = B.CPF_PESSOA)
 WHERE /*A.CPF = '18683178897'
   AND*/ NVL(A.FUNCIONARIO, '0') != NVL(B.EH_FUNCIONARIO, 'N');
