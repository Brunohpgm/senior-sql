-- DEVELOPS.VW_INTEGRA_CREDENCIAL_PESSOA source

 
  SELECT P.CD_PESSOA AS "PersonId",
       C.NU_CREDENCIAL AS "CredentialNumber",
       TO_CHAR(TRUNC(SYSDATE), 'YYYY-MM-DD') AS "InitialDate"
  FROM DEFAULT_ACESSO.PESSOA               P,
       DEFAULT_ACESSO.CREDENCIAL           C,
       LG.TB_CONTRATO_TRABALHO@INTEGRACOES CT,
       LG.TB_SITUACAO@INTEGRACOES          S
 WHERE P.NU_PIS IS NOT NULL
   AND C.NU_CREDENCIAL = P.NU_PIS
   AND P.NU_CPF = CT.CPF_PESSOA
   AND CT.ID_SITUACAO_COLABORADOR = S.ID_SITUACAO
   AND S.STATUS = 0 --n√£o sera necessario usar esse filtro
   AND S.TIPO != 5 --apenas amarrar com colaborador e usar situacao = 1
   AND NOT EXISTS (SELECT 1
          FROM DEFAULT_ACESSO.CREDENCIAL_PESSOA CP
         WHERE CP.CD_CREDENCIAL = C.CD_CREDENCIAL
           AND CP.CD_PESSOA = P.CD_PESSOA)
;